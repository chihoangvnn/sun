B·∫£n M√¥ t·∫£ K·ªπ thu·∫≠t: Module Qu·∫£n l√Ω S√°ch theo ISBN
1. T·ªïng quan & M·ª•c ti√™u üéØ
X√¢y d·ª±ng m·ªôt module d·ªãch v·ª• (microservice) ƒë·ªôc l·∫≠p ƒë·ªÉ qu·∫£n l√Ω v√† t·ªïng h·ª£p th√¥ng tin s√°ch t·ª´ nhi·ªÅu ngu·ªìn kh√°c nhau. Module n√†y s·∫Ω ho·∫°t ƒë·ªông nh∆∞ m·ªôt c∆° s·ªü d·ªØ li·ªáu trung t√¢m v·ªÅ s√°ch, ƒë∆∞·ª£c c·∫≠p nh·∫≠t b·ªüi m·ªôt c√¥ng c·ª• crawler v√† cung c·∫•p d·ªØ li·ªáu cho c√°c trang web kh√°c th√¥ng qua API.

ƒê·ªãnh danh duy nh·∫•t: ISBN (h·ªó tr·ª£ c·∫£ ISBN-10 v√† ISBN-13).

Ch·ª©c nƒÉng ch√≠nh:

L∆∞u tr·ªØ th√¥ng tin c·ªët l√µi c·ªßa s√°ch.

Theo d√µi gi√° v√† t√¨nh tr·∫°ng s√°ch t·ª´ nhi·ªÅu nh√† cung c·∫•p (Amazon, Walmart, v.v.).

Ghi l·∫°i l·ªãch s·ª≠ c·∫≠p nh·∫≠t gi√°.

Cung c·∫•p API c√¥ng khai (read-only) ƒë·ªÉ c√°c h·ªá th·ªëng kh√°c truy xu·∫•t d·ªØ li·ªáu.

2. C·∫•u tr√∫c D·ªØ li·ªáu (Database Schema) üóÉÔ∏è
Ch√∫ng ta s·∫Ω c·∫ßn √≠t nh·∫•t hai b·∫£ng ch√≠nh ƒë·ªÉ l∆∞u tr·ªØ d·ªØ li·ªáu m·ªôt c√°ch hi·ªáu qu·∫£.

B·∫£ng 1: Books (Th√¥ng tin c·ªët l√µi c·ªßa s√°ch)
B·∫£ng n√†y ch·ª©a c√°c th√¥ng tin √≠t thay ƒë·ªïi c·ªßa m·ªôt ƒë·∫ßu s√°ch.

T√™n c·ªôt	Ki·ªÉu d·ªØ li·ªáu	M√¥ t·∫£	Ghi ch√∫
isbn	VARCHAR(13)	M√£ ISBN-13 c·ªßa s√°ch.	Primary Key
isbn10	VARCHAR(10)	M√£ ISBN-10 (n·∫øu c√≥).	Indexed
title	VARCHAR(255)	T√™n s√°ch.	
author	VARCHAR(255)	T√°c gi·∫£.	
format	ENUM('Paperback', 'Hardcover', 'eBook', 'Unknown')	Ph√¢n lo·∫°i b√¨a s√°ch.	
review_count	INT	T·ªïng s·ªë l∆∞·ª£t ƒë√°nh gi√° (l·∫•y t·ª´ ngu·ªìn ch√≠nh).	
average_rating	DECIMAL(3, 2)	ƒêi·ªÉm ƒë√°nh gi√° trung b√¨nh (v√≠ d·ª•: 4.50).	
cover_image_url	VARCHAR(255)	URL ·∫£nh b√¨a s√°ch.	
created_at	TIMESTAMP	Th·ªùi gian t·∫°o record.	
updated_at	TIMESTAMP	Th·ªùi gian c·∫≠p nh·∫≠t record g·∫ßn nh·∫•t.	

Xu·∫•t sang Trang t√≠nh
B·∫£ng 2: BookPrices (Gi√° v√† T√¨nh tr·∫°ng t·ª´ c√°c Ngu·ªìn)
B·∫£ng n√†y l∆∞u tr·ªØ th√¥ng tin th∆∞·ªùng xuy√™n thay ƒë·ªïi t·ª´ c√°c nh√† cung c·∫•p.

T√™n c·ªôt	Ki·ªÉu d·ªØ li·ªáu	M√¥ t·∫£	Ghi ch√∫
id	BIGINT	ID t·ª± tƒÉng.	Primary Key
book_isbn	VARCHAR(13)	Kh√≥a ngo·∫°i, li√™n k·∫øt t·ªõi Books.isbn.	Foreign Key, Indexed
source	VARCHAR(50)	Ngu·ªìn cung c·∫•p (v√≠ d·ª•: 'Amazon', 'Walmart').	Indexed
price	DECIMAL(10, 2)	Gi√° s√°ch.	
currency	VARCHAR(3)	ƒê∆°n v·ªã ti·ªÅn t·ªá (v√≠ d·ª•: 'USD', 'VND').	
status	ENUM('In Stock', 'Out of Stock', 'Pre-order')	T√¨nh tr·∫°ng c√≤n h√†ng.	
source_url	VARCHAR(255)	Link ƒë·∫øn trang s·∫£n ph·∫©m c·ªßa ngu·ªìn ƒë√≥.	
last_updated_at	TIMESTAMP	Th·ªùi gian crawler g·ªçi API ƒë·ªÉ c·∫≠p nh·∫≠t.	

Xu·∫•t sang Trang t√≠nh
3. Lu·ªìng D·ªØ li·ªáu (Data Flow) üåä
Lu·ªìng c·∫≠p nh·∫≠t d·ªØ li·ªáu:
Crawler Tool ‚û°Ô∏è [POST] Internal Update API ‚û°Ô∏è Book Service Logic ‚û°Ô∏è L∆∞u v√†o Database (B·∫£ng Books & BookPrices)

Lu·ªìng truy xu·∫•t d·ªØ li·ªáu:
Website b√™n ngo√†i ‚û°Ô∏è [GET] Public Data API ‚û°Ô∏è Book Service Logic ‚û°Ô∏è ƒê·ªçc t·ª´ Database ‚û°Ô∏è Tr·∫£ v·ªÅ d·ªØ li·ªáu JSON

4. Thi·∫øt k·∫ø API ‚öôÔ∏è
Module c·∫ßn cung c·∫•p hai nh√≥m API: Internal (ƒë·ªÉ crawler c·∫≠p nh·∫≠t) v√† Public (ƒë·ªÉ c√°c b√™n kh√°c l·∫•y d·ªØ li·ªáu).

4.1. Internal API (D√†nh cho Crawler - Y√™u c·∫ßu x√°c th·ª±c b·∫±ng API Key)
Endpoint: POST /api/internal/books/update

M√¥ t·∫£: Th√™m m·ªõi ho·∫∑c c·∫≠p nh·∫≠t ƒë·ªìng th·ªùi th√¥ng tin s√°ch v√† gi√° t·ª´ m·ªôt ngu·ªìn c·ª• th·ªÉ. Service s·∫Ω t·ª± ki·ªÉm tra xem ISBN ƒë√£ t·ªìn t·∫°i hay ch∆∞a ƒë·ªÉ quy·∫øt ƒë·ªãnh t·∫°o m·ªõi hay c·∫≠p nh·∫≠t.

Request Body (JSON):

JSON

{
  "isbn": "9780593359396",
  "isbn10": "0593359391",
  "title": "A Court of Thorns and Roses",
  "author": "Sarah J. Maas",
  "format": "Paperback",
  "review_count": 150000,
  "average_rating": 4.7,
  "cover_image_url": "http://example.com/cover.jpg",
  "price_data": {
    "source": "Amazon",
    "price": 12.99,
    "currency": "USD",
    "status": "In Stock",
    "source_url": "http://amazon.com/dp/0593359391"
  }
}
Response:

200 OK: { "status": "success", "message": "Book data updated." }

400 Bad Request: { "status": "error", "message": "Invalid input data." }

401 Unauthorized: L·ªói sai API Key.

4.2. Public API (C√¥ng khai, Read-only)
Endpoint 1: L·∫•y th√¥ng tin chi ti·∫øt s√°ch theo ISBN
GET /api/public/books/{isbn}

M√¥ t·∫£: L·∫•y to√†n b·ªô th√¥ng tin chi ti·∫øt c·ªßa m·ªôt cu·ªën s√°ch, bao g·ªìm gi√° t·ª´ t·∫•t c·∫£ c√°c ngu·ªìn ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t.

Response (JSON):

JSON

{
  "isbn": "9780593359396",
  "isbn10": "0593359391",
  "title": "A Court of Thorns and Roses",
  "author": "Sarah J. Maas",
  "format": "Paperback",
  "review_count": 150000,
  "average_rating": 4.7,
  "cover_image_url": "http://example.com/cover.jpg",
  "updated_at": "2025-09-26T10:00:00Z",
  "prices": [
    {
      "source": "Amazon",
      "price": 12.99,
      "currency": "USD",
      "status": "In Stock",
      "source_url": "http://amazon.com/dp/0593359391",
      "last_updated_at": "2025-09-26T09:30:00Z"
    },
    {
      "source": "Walmart",
      "price": 13.50,
      "currency": "USD",
      "status": "Out of Stock",
      "source_url": "http://walmart.com/...",
      "last_updated_at": "2025-09-26T08:45:00Z"
    }
  ]
}
Endpoint 2: T√¨m ki·∫øm s√°ch
GET /api/public/books/search?q={keyword}&limit=20&page=1

M√¥ t·∫£: T√¨m ki·∫øm s√°ch theo title ho·∫∑c author.

Response: Tr·∫£ v·ªÅ m·ªôt danh s√°ch c√°c ƒë·ªëi t∆∞·ª£ng s√°ch (c√≥ th·ªÉ kh√¥ng k√®m gi√° ƒë·ªÉ tƒÉng t·ªëc ƒë·ªô), c√≥ ph√¢n trang.

